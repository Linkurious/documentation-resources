# [CVE-2021-44228][1]
This vulnerability - also known as "[Log4Shell][2]" - affects the Log4j library, which is a very common 
logging library for Java.

## Timeline
- 2021-12-09: Vulnerability first disclosed by Log4j
- 2021-12-10: Vulnerability disclosed by Elasticsearch
- 2021-12-13: Linkurious discloses this document, including manual patch procedures
- 2021-12-16: Linkuriuous releases [Linkurious Enterprise v3.0.6][7], which fixes the vulnerability for new deployments
- 2022-01-03: Added notes on other Log4j-related vulnerabilities

## Who is affected?
Users of Linkurious Enterprise who are using the **embedded Elasticsearch** are affected.
To test for that, open your configuration file (`data/config/production.json`) and look for 
entries under `dataSources.*.index.vendor` with a value of `"elasticSearch"` (not `"elasticSearch2"`). 
If you have any data-source with the index vendor `"elasticSearch"`, you are affected.

## What is the impact?
From [Elastic's public communication][3]:
> Elasticsearch is not susceptible to remote code execution with this vulnerability due to our use of the Java Security Manager.
> Elasticsearch on JDK8 or below is susceptible to an information leak via DNS which is fixed by a simple JVM property change.
> The information leak does not permit access to data within the Elasticsearch cluster.

As far as we understand, this means that the content of environment variables from the server on which Linkurious Enterprise is
installed could be leaked.

Note that Linkurious Enterprise's embedded Elasticsearch does not listen for external connections, but only for local 
connections (i.e. it does not bind to `0.0.0.0` but to `127.0.0.1`). This limits the risk to attackers who already
have access to the server hosting Linkurious Enterprise.

## How can it be patched?
For users of **Linkurious Enterprise 2.10**: do not use the embedded Elasticsearch. Switch to "Neo4j search" or to an external
Elasticsearch cluster with a recent version.

For users of **Linkurious Enterprise 3.0**:
- [Stop Linkurious Enterprise][5]
- Edit the following file: `linkurious/data/manager/manager.json` and edit it.
  Edit the entry that configures the environment variable for Elasticsearch process to change this:
  ```json
  "env": {
    "ES_HEAP_SIZE": "2g"
  }
  ```
  into this:
  ```json
  "env": {
    "ES_HEAP_SIZE": "2g",
    "ES_JAVA_OPTS": "-Dlog4j2.formatMsgNoLookups=true -Dlog4j2.disable.jmx=true"
  }
  ```
- [Start Linkurious Enterprise][6]
- You are good to go!

## Other Log4j-related vulnerabilities
- CVE-2021-44228, CVE-2021-45046: both these issues are fixed by following the above instructions 
- CVE-2021-45105: Elasticsearch is not affected by this vulnerability 

source: [official Elasticsearch statement][3]

## Updating to a fixed version
[Linkurious Enterprise v3.0.6][7] has been released and fixes the vulnerability for new deployments.
If you are already using Linkurious Enterpise, updating to a fixed version is not enough, and you need to apply the 
fix described in the previous section.

## Other recommendations
If you are using Linkurious Enterprise in combination with Neo4j, please folow the [instructions provided by Neo4j][4].
If you are using Linkurious Enterprise in combination with you own Elasticsearch cluster, please follow the [instructions provided by Elastic][3].

[1]: https://nvd.nist.gov/vuln/detail/CVE-2021-44228
[2]: https://en.wikipedia.org/wiki/Log4Shell
[3]: https://discuss.elastic.co/t/apache-log4j2-remote-code-execution-rce-vulnerability-cve-2021-44228-esa-2021-31/291476
[4]: https://neo4j.com/security/log4j/
[5]: https://doc.linkurio.us/admin-manual/latest/stop/
[6]: https://doc.linkurio.us/admin-manual/latest/start/
[7]: https://get.linkurio.us/
